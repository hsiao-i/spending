import{d as S,l as b,b as E,t as D,x as U,af as j,o as c,e as i,f as e,u as _,s as F,i as $,h as v,w as q,n as V,F as x,p as C,q as m,S as I,r as M,m as R,ag as L,j as O,c as N}from"./index-d6314024.js";import{M as G}from"./ModalShare-d6c45fef.js";import{i as A}from"./http-b3c12b6b.js";const J={class:"p-4"},z=e("div",{class:"text-end mb-3"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"h4 mb-3"},T={key:0},H={key:1},K={class:"mb-3"},Q=e("label",{for:"帳戶名稱",class:"form-label"},"帳戶名稱",-1),W={class:"mb-3"},X=e("label",{for:"帳戶初始金額",class:"form-label"},"帳戶初始金額",-1),Y={class:"mb-3"},Z=e("label",{for:"使用銀行",class:"form-label"},"使用銀行",-1),ee={id:"recordAssetBank"},te=["value"],se={class:"py-4"},oe=["disabled"],ne=S({__name:"BankAssetUpdate",props:{account:null,openState:null},emits:["getBankAccount","closeModal"],setup(B,{emit:h}){const p=B,o=b([]),k=async()=>{try{const d="/banks",n=await A.get(d);o.value=n.data}catch{I.fire({icon:"error",title:"取得銀行帳戶列表失敗"})}};E(()=>{k()});const{account:s,openState:f}=D(p),y=U(()=>{const d=o.value.find(n=>n.name===s.value.bankName);return d?d.id:null});j(y,()=>{s.value.bankId=y.value});const g=b(),w=async()=>{try{s.value.userId=localStorage.getItem("userId");let d="/personalBankAccounts",n="post",a="成功新增帳戶";f.value==="edit"&&(d=`/personalBankAccounts/${s.value.id}`,n="put",a="成功更新帳戶"),await A[n](d,s.value),I.fire({icon:"success",title:a,confirmButtonColor:"#7fbcd2"}),g.value.resetForm(),h("closeModal"),h("getBankAccount")}catch{I.fire({icon:"error",title:"失敗，請再次操作或連繫管理員",confirmButtonColor:"#cb7d56"})}};return(d,n)=>{const a=M("VField"),l=M("ErrorMessage"),t=M("VForm");return c(),i("div",J,[z,e("h3",P,[_(f)==="new"?(c(),i("span",T,"新增")):_(f)==="edit"?(c(),i("span",H,"編輯")):F("",!0),$("帳戶 ")]),v(t,{onSubmit:w,ref_key:"formClear",ref:g},{default:q(({errors:r})=>[e("div",K,[Q,v(a,{type:"text",class:V(["form-control",{"is-invalid":r.帳戶名稱}]),id:"帳戶名稱",placeholder:"為帳戶取一個名稱",name:"帳戶名稱",rules:"required",modelValue:_(s).name,"onUpdate:modelValue":n[0]||(n[0]=u=>_(s).name=u)},null,8,["class","modelValue"]),v(l,{name:"帳戶名稱",class:"invalid-feedback"})]),e("div",W,[X,v(a,{type:"number",class:V(["form-control",{"is-invalid":r.帳戶初始金額}]),id:"recordBankAmount",placeholder:"設定帳戶初始金額",name:"帳戶初始金額",rules:"required",modelValue:_(s).total,"onUpdate:modelValue":n[1]||(n[1]=u=>_(s).total=u)},null,8,["class","modelValue"]),v(l,{name:"帳戶初始金額",class:"invalid-feedback"})]),e("div",Y,[Z,v(a,{type:"text",list:"recordAssetBank",class:V(["form-select",{"is-invalid":r.使用銀行}]),id:"使用銀行",name:"使用銀行",placeholder:"請選擇此帳戶使用的銀行",rules:"required",modelValue:_(s).bankName,"onUpdate:modelValue":n[2]||(n[2]=u=>_(s).bankName=u)},null,8,["class","modelValue"]),e("datalist",ee,[(c(!0),i(x,null,C(o.value,u=>(c(),i("option",{key:u.code,value:u.name},m(`${u.code} ${u.name}`),9,te))),128))]),v(l,{name:"使用銀行",class:"invalid-feedback"})]),e("div",se,[e("button",{type:"submit",class:"btn btn-primary w-100",disabled:Object.keys(r).length>0}," 儲存 ",8,oe)])]),_:1},512)])}}}),ae=e("div",{class:"bg-danger p-3 d-flex justify-content-between rounded-top"},[e("h3",{class:"text-white h4 mb-0"},"刪除帳戶"),e("div",null,[e("button",{type:"button",class:"btn-close btn-light","data-bs-dismiss":"modal","aria-label":"Close"})])],-1),le={class:"p-4"},ce=e("p",null,"是否確認刪除此銀行帳戶？",-1),de={class:"h6"},ie={class:"text-danger"},ue={class:"h6"},re={class:"text-danger"},_e=S({__name:"BankAssetDelete",props:{account:null},emits:["getBankAccount","closeModal"],setup(B,{emit:h}){const p=B,{account:o}=D(p),k=async()=>{try{const s=`/personalBankAccounts/${o.value.id}?_noRemoveDependents=true`;await A.delete(s),h("closeModal"),h("getBankAccount")}catch{I.fire({icon:"error",title:"刪除銀行帳戶失敗"})}};return(s,f)=>(c(),i(x,null,[ae,e("div",le,[ce,e("p",de,[$("帳戶名稱："),e("span",ie,m(_(o).name),1)]),e("p",ue,[$("帳戶總額："),e("span",re,m(_(o).total),1)]),e("div",{class:"text-end"},[e("button",{type:"button",class:"btn btn-danger w-25",onClick:k},"刪除")])])],64))}}),me={class:"container"},he=e("h2",null,"資產管理",-1),pe={class:"row gx-4"},ve={class:"col-md-6 mb-3"},be={class:"min-vh-80 max-vh-80 overflow-auto shadow p-4 rounded-4 bg-light"},ke={class:"list-unstyled"},fe={class:"d-flex justify-content-end"},ye=["onClick"],ge=e("span",{class:"material-icons-outlined text-light"},"edit",-1),xe=[ge],we=["onClick"],$e=e("span",{class:"material-icons-outlined text-light"},"delete_forever",-1),Ae=[$e],Be={class:"h5 text-center"},Ce={class:"h6"},Ie={class:"col-md-6"},Ve={class:"bg-light shadow rounded-5 p-3 min-vh-80 max-vh-80"},Me=e("h3",{class:"h5 text-center"},"帳戶收支查看",-1),Se={class:"my-3 d-flex align-items-center"},Ne=e("label",{for:"chooseAccount",class:"col-2"},"帳戶",-1),Ee=e("option",{value:"",disabled:"",selected:""},"請選擇",-1),De=["value"],Fe=O('<div class="d-flex text-center border-bottom"><h6 class="w-25">時間</h6><h6 class="w-25">類別</h6><h6 class="w-25">名稱</h6><h6 class="w-25">金額</h6></div>',1),qe={class:"overflow-auto"},Ue={style:{height:"58vh"}},je={class:"w-25 mb-0"},Re={class:"w-25 mb-0"},Le={class:"w-25 mb-0"},Oe={class:"w-25 mb-0"},Pe=S({__name:"RecordAssets",setup(B){const h=b(),p=b({total:"",name:"",bankName:"",bankId:0,userId:"",autoIncome:0,autoIncomeDate:"",autoExpense:0,autoExpenseDate:""}),o=b(""),k=(a,l)=>{o.value=a,a==="edit"?(o.value="edit",p.value=JSON.parse(JSON.stringify(l))):a==="new"?(o.value="new",p.value={total:"",name:"",bankName:"",bankId:0,userId:"",autoIncome:0,autoIncomeDate:"",autoExpense:0,autoExpenseDate:""}):a==="delete"&&(o.value="delete",p.value={...l}),h.value.openModalInComponent()},s=()=>{h.value.closeModalInComponent()},f=localStorage.getItem("userId"),y=b([]),g=async()=>{const a=`/personalBankAccounts?userId=${f}&_expand=bank`,l=await A.get(a);y.value=l.data},w=b(""),d=b([]),n=async()=>{const a=`expenses?user=${f}&personalBankAccountId=${w.value}&_expand=expenseCategory`,l=await A.get(a);d.value=l.data};return E(()=>{g(),n()}),(a,l)=>(c(),i(x,null,[v(G,{ref_key:"modalShare",ref:h},{"record-assets":q(()=>[o.value==="edit"||o.value==="new"?(c(),N(ne,{key:0,onGetBankAccount:g,onCloseModal:s,account:p.value,"open-state":o.value},null,8,["account","open-state"])):o.value==="delete"?(c(),N(_e,{key:1,account:p.value,onGetBankAccount:g,onCloseModal:s},null,8,["account"])):F("",!0)]),_:1},512),e("div",me,[he,e("div",pe,[e("div",ve,[e("div",be,[e("button",{type:"button",class:"add-bank btn rounded-4 mb-3 w-100",onClick:l[0]||(l[0]=t=>k("new"))},"+ 新增帳戶"),e("ul",ke,[(c(!0),i(x,null,C(y.value,t=>{var r;return c(),i("li",{class:"mb-3 bg-primary-warning-gradient rounded-4 p-3",style:{height:"7rem"},key:t.id},[e("div",fe,[e("div",null,[e("button",{type:"button",class:"btn p-0",onClick:u=>k("edit",t)},xe,8,ye),e("button",{type:"button",class:"btn p-0",onClick:u=>k("delete",t)},Ae,8,we)])]),e("p",Be,[$(m(t.name)+" ",1),e("span",Ce," ("+m((r=t.bank)==null?void 0:r.name)+")",1)])])}),128))])])]),e("div",Ie,[e("div",Ve,[Me,e("div",null,[e("div",Se,[Ne,R(e("select",{class:"form-select",name:"chooseAccount",id:"chooseAccount","onUpdate:modelValue":l[1]||(l[1]=t=>w.value=t),onChange:n},[Ee,(c(!0),i(x,null,C(y.value,t=>(c(),i("option",{key:t.bankName,value:t.id},m(t.bankName),9,De))),128)),$("> ")],544),[[L,w.value]])]),e("div",null,[Fe,e("div",qe,[e("div",Ue,[(c(!0),i(x,null,C(d.value,t=>{var r;return c(),i("div",{class:"d-flex text-center border-bottom py-2",key:t.uuid},[e("h6",je,m(t.date),1),e("h6",Re,m((r=t.expenseCategory)==null?void 0:r.name),1),e("h6",Le,m(t.name),1),e("h6",Oe,m(t.amount),1)])}),128))])])])])])])])])],64))}});export{Pe as default};
