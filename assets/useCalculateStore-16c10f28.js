import{k as g,l as i,S as u,b as p,x as c}from"./index-d6314024.js";import{i as f}from"./http-b3c12b6b.js";import{v as S}from"./v4-a960c1f4.js";const b=g("spending",()=>{const r=i([]),I=async()=>{try{const e=`expenses?_expand=personalBankAccount&_expand=expenseCategory&userId=${localStorage.getItem("userId")}`,n=await f.get(e);r.value=n.data}catch{u.fire({icon:"error",title:"取得支出列表失敗",confirmButtonColor:"#cb7d56"})}},a=i({uuid:S(),dateTime:new Date,date:"",name:"",amount:"",description:"",incomeCategoryId:0,personalBankAccountId:0,userId:""}),l=()=>{a.value.date=new Date().toISOString().slice(0,10)},s=i([]),m=async()=>{try{const e=`incomes?_expand=personalBankAccount&_expand=incomeCategory&userId=${localStorage.getItem("userId")}`,n=await f.get(e);s.value=n.data}catch{u.fire({icon:"error",title:"取得收入列表失敗",confirmButtonColor:"#cb7d56"})}},d=i("");return{expenseList:r,getExpense:I,updateIncomeInfo:async()=>{try{a.value.userId=localStorage.getItem("userId");let t="/incomes",e="post",n="成功新增收入";d.value==="edit"&&(t=`/incomes/${a.value.id}`,e="put",n="成功更新收入"),await f[e](t,a.value),u.fire({icon:"success",title:n,confirmButtonColor:"#7fbcd2"}),m()}catch{u.fire({icon:"error",title:"失敗，請再次操作或連繫管理員",confirmButtonColor:"#cb7d56"})}},updateIncomeData:a,formatDate:l,incomeList:s,getIncomeList:m,requestState:d}}),h=g("calculate",()=>{const r=b(),I=i({balance:0,expense:0,income:0});p(async()=>{try{await r.getExpense(),await r.getIncomeList()}catch{u.fire({icon:"error",title:"錯誤，請聯繫管理員"})}});const a=c(()=>new Date().toISOString().slice(0,7)),l=c(()=>{let o=0;return r.expenseList.forEach(t=>{t.date.slice(0,7)===a.value&&(o+=Number(t.amount))}),o}),s=c(()=>{let o=0;return r.incomeList.forEach(t=>{t.date.slice(0,7)===a.value&&(o+=Number(t.amount))}),o}),m=c(()=>s.value-l.value),d=c(()=>r.expenseList.reduce((o,t)=>{const{personalBankAccount:e,amount:n}=t;return(e==null?void 0:e.bankName)in o?o[e==null?void 0:e.bankName]=o[e==null?void 0:e.bankName]+Number(n):o[e==null?void 0:e.bankName]=Number(n),o},{}));return{monthBankTotal:I,incomeMonthTotal:s,expenseMonthTotal:l,calculateMonthTotal:m,singleBankTotal:d,totalCalculateFormat:a}});export{h as a,b as u};
